/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/computation/expressions.py:21: UserWarning: Pandas requires version '2.8.4' or newer of 'numexpr' (version '2.8.1' currently installed).
  from pandas.core.computation.check import NUMEXPR_INSTALLED
/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/arrays/masked.py:61: UserWarning: Pandas requires version '1.3.6' or newer of 'bottleneck' (version '1.3.2' currently installed).
  from pandas.core import (
/usr/lib/python3/dist-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
Warning: UMAP not available, will use PCA only for 8D visualization
/home/other/johna/.local/lib/python3.10/site-packages/matplotlib/projections/__init__.py:63: UserWarning: Unable to import Axes3D. This may be due to multiple versions of Matplotlib being installed (e.g. as a system package and as a pip package). As a result, the 3D projection is not available.
  warnings.warn("Unable to import Axes3D. This may be due to multiple versions of "
================================================================================
VAE GRA v2.3 - Adding Relative Depth
================================================================================
Using device: cpu

Loading data...
Loaded 238,506 samples from 296 boreholes
After removing NaN: 238,506 samples

Applying distribution-aware scaling:
  GRA bulk density:         Gaussian      → StandardScaler
  Magnetic susceptibility:  Poisson       → sign(x)*log(|x|+1) + StandardScaler
  NGR:                      Bimodal       → sign(x)*log(|x|+1) + StandardScaler
  R, G, B:                  Log-normal    → log(x+1) + StandardScaler
  Relative Depth:           Uniform (0-1) → StandardScaler
Found 139 unique lithologies

Data split by borehole:
  Train: 206 boreholes, 174,636 samples
  Val:   45 boreholes, 33,277 samples
  Test:  45 boreholes, 30,593 samples

================================================================================
Training 2D Latent Model
================================================================================
Model parameters: 1,867

Training...

Training VAE with latent dim=2, beta=1.0
============================================================
Epoch   0: Train=5.751, Val=4.761
Epoch   5: Train=4.514, Val=4.522
Epoch  10: Train=4.437, Val=4.496
Epoch  15: Train=4.402, Val=4.462
Epoch  20: Train=4.386, Val=4.490
Epoch  25: Train=4.369, Val=4.488

Early stopping at epoch 25
Best validation loss: 4.462

Training completed in 101.7 seconds

✓ Saved checkpoint to /home/utig5/johna/bhai/ml_models/checkpoints/vae_gra_v2_3_latent2.pth

============================================================
CLUSTERING ANALYSIS
============================================================

k= 5: Silhouette=0.387, ARI=0.125
  Cluster  0 (n= 2944): gabbro (77.3%)
  Cluster  2 (n= 2757): nannofossil ooze (58.8%)

k=10: Silhouette=0.395, ARI=0.135
  Cluster  4 (n= 1703): gabbro (93.1%)
  Cluster  5 (n= 1076): nannofossil ooze (64.5%)
  Cluster  9 (n= 1430): nannofossil ooze (60.3%)

k=15: Silhouette=0.411, ARI=0.164
  Cluster  3 (n= 1458): gabbro (96.5%)
  Cluster  4 (n= 1271): nannofossil ooze (59.7%)
  Cluster 10 (n= 1037): nannofossil ooze (65.0%)
  Cluster 11 (n= 1003): gabbro (89.8%)
  Cluster 12 (n=  362): gabbro (51.4%)

k=20: Silhouette=0.389, ARI=0.143
  Cluster  3 (n= 1113): gabbro (98.5%)
  Cluster  6 (n=  658): nannofossil ooze (74.9%)
  Cluster  8 (n=  812): gabbro (88.7%)
  Cluster 10 (n=  261): gabbro (62.5%)
  Cluster 11 (n=  698): nannofossil ooze (58.3%)
  Cluster 15 (n= 1048): nannofossil ooze (54.1%)
  Cluster 19 (n=  607): gabbro (86.7%)

================================================================================
Training 8D Latent Model
================================================================================
Model parameters: 2,167

Training...

Training VAE with latent dim=8, beta=1.0
============================================================
Epoch   0: Train=6.094, Val=4.980
Epoch   5: Train=4.532, Val=4.491
Epoch  10: Train=4.460, Val=4.446
Epoch  15: Train=4.402, Val=4.378
Epoch  20: Train=4.364, Val=4.399
Epoch  25: Train=4.351, Val=4.394

Early stopping at epoch 25
Best validation loss: 4.378

Training completed in 111.7 seconds

✓ Saved checkpoint to /home/utig5/johna/bhai/ml_models/checkpoints/vae_gra_v2_3_latent8.pth

============================================================
CLUSTERING ANALYSIS
============================================================

k= 5: Silhouette=0.340, ARI=0.104
  Cluster  0 (n= 2423): gabbro (90.5%)
  Cluster  2 (n= 3651): nannofossil ooze (65.6%)

k=10: Silhouette=0.334, ARI=0.153
  Cluster  3 (n= 1900): nannofossil ooze (70.4%)
  Cluster  5 (n= 1684): gabbro (93.1%)
  Cluster  6 (n= 1208): gabbro (76.0%)

k=15: Silhouette=0.338, ARI=0.181
  Cluster  4 (n= 1566): nannofossil ooze (64.3%)
  Cluster  6 (n=  383): gabbro (56.1%)
  Cluster  7 (n= 1172): gabbro (83.6%)
  Cluster 10 (n= 1358): gabbro (95.1%)
  Cluster 13 (n= 1011): nannofossil ooze (64.5%)

k=20: Silhouette=0.341, ARI=0.175
  Cluster  2 (n=  763): gabbro (85.3%)
  Cluster  5 (n= 1343): chalk (58.5%)
  Cluster  6 (n= 1315): nannofossil ooze (80.5%)
  Cluster  8 (n=  995): nannofossil ooze (63.8%)
  Cluster 10 (n= 1226): gabbro (96.2%)
  Cluster 11 (n=  294): gabbro (53.1%)
  Cluster 14 (n= 1284): nannofossil ooze (62.1%)
  Cluster 16 (n=  546): gabbro (91.8%)
  Cluster 19 (n= 1118): diatom ooze (50.7%)

================================================================================
VAE GRA v2.3 Training Complete!
================================================================================

