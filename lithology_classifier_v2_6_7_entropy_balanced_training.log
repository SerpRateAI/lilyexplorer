/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/computation/expressions.py:21: UserWarning: Pandas requires version '2.8.4' or newer of 'numexpr' (version '2.8.1' currently installed).
  from pandas.core.computation.check import NUMEXPR_INSTALLED
/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/arrays/masked.py:61: UserWarning: Pandas requires version '1.3.6' or newer of 'bottleneck' (version '1.3.2' currently installed).
  from pandas.core import (
/usr/lib/python3/dist-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
Warning: UMAP not available, will use PCA only for 8D visualization
/home/other/johna/.local/lib/python3.10/site-packages/matplotlib/projections/__init__.py:63: UserWarning: Unable to import Axes3D. This may be due to multiple versions of Matplotlib being installed (e.g. as a system package and as a pip package). As a result, the 3D projection is not available.
  warnings.warn("Unable to import Axes3D. This may be due to multiple versions of "
====================================================================================================
LITHOLOGY CLASSIFIER USING v2.6.7 VAE EMBEDDINGS (ENTROPY-BALANCED SPLIT)
====================================================================================================

Loading data...
Total samples: 238,506
Total boreholes: 296
Unique lithologies: 139

Number of classes: 139

Performing entropy-balanced borehole split...
Train: 165,836 samples (211 boreholes, 69.5%)
Val:   35,869 samples (37 boreholes, 15.0%)
Test:  36,801 samples (48 boreholes, 15.4%)

Lithology entropy:
  Train: 4.4726
  Val:   4.2236
  Test:  4.1235
  Max difference: 0.3491

Loading v2.6.7 VAE model...
Device: cuda
✓ VAE loaded successfully

Scaling features...
✓ Features scaled

Extracting VAE embeddings...
✓ Embeddings extracted in 1.3s
  Embedding shape: (165836, 10)

Embedding statistics:
  Dim 0: std=1.0517 ✓
  Dim 1: std=0.8130 ✓
  Dim 2: std=0.0077 ✗
  Dim 3: std=0.2887 ✓
  Dim 4: std=0.0157 ✗
  Dim 5: std=0.0054 ✗
  Dim 6: std=0.0262 ✗
  Dim 7: std=0.0179 ✗
  Dim 8: std=0.3628 ✓
  Dim 9: std=0.0097 ✗

====================================================================================================
TRAINING LITHOLOGY CLASSIFIER
====================================================================================================
Classifier parameters: 7,371

Starting training...

Epoch   1: Train Loss=2.7119, Train Acc=31.44%, Val Loss=2.6333, Val Acc=27.40%
Epoch   5: Train Loss=2.0034, Train Acc=40.91%, Val Loss=2.5632, Val Acc=28.61%
Epoch  10: Train Loss=1.9185, Train Acc=42.44%, Val Loss=2.5449, Val Acc=29.61%
Epoch  15: Train Loss=1.8804, Train Acc=43.02%, Val Loss=2.5366, Val Acc=29.38%
Epoch  20: Train Loss=1.8513, Train Acc=43.81%, Val Loss=2.5356, Val Acc=30.46%
Epoch  25: Train Loss=1.8302, Train Acc=44.18%, Val Loss=2.5534, Val Acc=31.60%
Epoch  30: Train Loss=1.8190, Train Acc=44.47%, Val Loss=2.5515, Val Acc=30.98%
Epoch  35: Train Loss=1.8017, Train Acc=44.77%, Val Loss=2.5646, Val Acc=30.44%
Epoch  40: Train Loss=1.7924, Train Acc=45.01%, Val Loss=2.5590, Val Acc=30.86%

Early stopping at epoch 43

Best validation accuracy: 32.22%
Best validation loss: 2.5638
Training completed in 98.2s (1.6 min)

====================================================================================================
TEST SET EVALUATION
====================================================================================================
Test Accuracy (unweighted): 42.57%
/home/other/johna/.local/lib/python3.10/site-packages/sklearn/metrics/_classification.py:2801: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
Test Accuracy (balanced):   5.26%

Top 10 Most Common Lithologies:
  nannofossil ooze              :   9728 samples, Acc=87.31%
  clay                          :   4192 samples, Acc=77.43%
  wackestone                    :   3529 samples, Acc=52.76%
  packstone                     :   2206 samples, Acc=31.32%
  mudstone                      :   1723 samples, Acc=35.81%
  claystone                     :   1710 samples, Acc=0.00%
  clayey silt                   :   1669 samples, Acc=0.00%
  silty clay                    :   1502 samples, Acc=0.40%
  clast-poor sandy diamict      :   1323 samples, Acc=0.00%
  sand                          :   1217 samples, Acc=48.81%

Classes with no training samples:
  Found 9 classes in test but not in train:
    carbonate: 3 test samples
    coarse sand and gravel: 5 test samples
    foraminifera mud: 3 test samples
    granofels: 11 test samples
    gravelly sand: 1 test samples
    medium sand: 16 test samples
    muddy sand: 3 test samples
    muddy sand/sandstone to silty mud/mudstone: 32 test samples
    nannofossil mud: 1 test samples

====================================================================================================
✓ Classifier trained successfully
  Test Accuracy (unweighted): 42.57%
  Test Accuracy (balanced):   5.26%
  Model saved: ml_models/checkpoints/lithology_classifier_v2_6_7_entropy_balanced_best.pth
====================================================================================================
