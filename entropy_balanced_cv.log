/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/computation/expressions.py:21: UserWarning: Pandas requires version '2.8.4' or newer of 'numexpr' (version '2.8.1' currently installed).
  from pandas.core.computation.check import NUMEXPR_INSTALLED
/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/arrays/masked.py:61: UserWarning: Pandas requires version '1.3.6' or newer of 'bottleneck' (version '1.3.2' currently installed).
  from pandas.core import (
/usr/lib/python3/dist-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
Warning: UMAP not available, will use PCA only for 8D visualization
/home/other/johna/.local/lib/python3.10/site-packages/matplotlib/projections/__init__.py:63: UserWarning: Unable to import Axes3D. This may be due to multiple versions of Matplotlib being installed (e.g. as a system package and as a pip package). As a result, the 3D projection is not available.
  warnings.warn("Unable to import Axes3D. This may be due to multiple versions of "
====================================================================================================
ENTROPY-BALANCED CROSS-VALIDATION
====================================================================================================

Full dataset statistics:
  Total samples: 238,506
  Unique lithologies: 139
  Lithology entropy: 3.119

Total boreholes: 296
Unique dominant lithologies: 50

Device: cuda
K-fold CV: 5 folds (stratified by dominant lithology)

/home/other/johna/.local/lib/python3.10/site-packages/sklearn/model_selection/_split.py:811: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  warnings.warn(
====================================================================================================
FOLD 1/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.119, n_lith=139
  Train set:     entropy=3.099, n_lith=127
  Test set:      entropy=2.955, n_lith=86
  Train Δentropy: 0.019
  Test Δentropy:  0.164

/home/other/johna/.local/lib/python3.10/site-packages/sklearn/model_selection/_split.py:811: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=7.
  warnings.warn(
Train: 161,659 samples (202 boreholes)
Val:   31,131 samples (34 boreholes)
Test:  45,716 samples (60 boreholes)

Results:
  Training time: 57.2s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=10, ARI=0.2366, Sil=0.2040

====================================================================================================
FOLD 2/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.119, n_lith=139
  Train set:     entropy=3.113, n_lith=132
  Test set:      entropy=2.927, n_lith=86
  Train Δentropy: 0.005
  Test Δentropy:  0.192

/home/other/johna/.local/lib/python3.10/site-packages/sklearn/model_selection/_split.py:811: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=7.
  warnings.warn(
Train: 155,507 samples (203 boreholes)
Val:   33,538 samples (34 boreholes)
Test:  49,461 samples (59 boreholes)

Results:
  Training time: 53.0s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=12, ARI=0.2345, Sil=0.1998

====================================================================================================
FOLD 3/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.119, n_lith=139
  Train set:     entropy=3.120, n_lith=134
  Test set:      entropy=2.974, n_lith=80
  Train Δentropy: 0.001
  Test Δentropy:  0.144

/home/other/johna/.local/lib/python3.10/site-packages/sklearn/model_selection/_split.py:811: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=7.
  warnings.warn(
Train: 163,286 samples (203 boreholes)
Val:   26,077 samples (34 boreholes)
Test:  49,143 samples (59 boreholes)

Results:
  Training time: 51.8s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=12, ARI=0.1792, Sil=0.2248

====================================================================================================
FOLD 4/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.119, n_lith=139
  Train set:     entropy=3.084, n_lith=134
  Test set:      entropy=3.116, n_lith=81
  Train Δentropy: 0.034
  Test Δentropy:  0.002

/home/other/johna/.local/lib/python3.10/site-packages/sklearn/model_selection/_split.py:811: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=7.
  warnings.warn(
Train: 166,652 samples (203 boreholes)
Val:   29,039 samples (34 boreholes)
Test:  42,815 samples (59 boreholes)

Results:
  Training time: 55.1s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=15, ARI=0.1320, Sil=0.1378

====================================================================================================
FOLD 5/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.119, n_lith=139
  Train set:     entropy=3.113, n_lith=127
  Test set:      entropy=2.883, n_lith=93
  Train Δentropy: 0.006
  Test Δentropy:  0.235

/home/other/johna/.local/lib/python3.10/site-packages/sklearn/model_selection/_split.py:811: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=7.
  warnings.warn(
Train: 157,033 samples (203 boreholes)
Val:   30,102 samples (34 boreholes)
Test:  51,371 samples (59 boreholes)

Results:
  Training time: 55.5s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=10, ARI=0.1681, Sil=0.1957

====================================================================================================
ENTROPY-BALANCED CROSS-VALIDATION SUMMARY
====================================================================================================

 fold  train_samples  test_samples  train_entropy  test_entropy  train_entropy_diff  test_entropy_diff  best_k  best_ari  best_sil
    1         161659         45716       3.099178      2.954837            0.019369           0.163710      10  0.236581  0.203975
    2         155507         49461       3.113192      2.926798            0.005355           0.191749      12  0.234535  0.199823
    3         163286         49143       3.120003      2.974420            0.001456           0.144127      12  0.179244  0.224765
    4         166652         42815       3.084091      3.116122            0.034456           0.002425      15  0.132046  0.137759
    5         157033         51371       3.112599      2.883398            0.005948           0.235149      10  0.168068  0.195697

ARI Statistics:
  Mean: 0.1901
  Std:  0.0450
  Min:  0.1320
  Max:  0.2366
  95% CI: [0.1018, 0.2783]

Entropy Balance:
  Full dataset entropy: 3.119
  Mean test entropy diff: 0.147
  Max test entropy diff: 0.235

====================================================================================================
COMPARISON TO ORIGINAL v2.6.6
====================================================================================================
Original v2.6.6 (biased split):     ARI = 0.286, test entropy = 2.950 (Δ=0.169)
Entropy-balanced CV mean:           ARI = 0.1901 ± 0.0450

⚠️  Original result outside 95% CI - biased split

Estimated performance loss from biased split: 33.5%
====================================================================================================

Results saved to: v2_6_6_entropy_balanced_cv.csv
