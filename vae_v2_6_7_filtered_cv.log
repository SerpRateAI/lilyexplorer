/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/computation/expressions.py:21: UserWarning: Pandas requires version '2.8.4' or newer of 'numexpr' (version '2.8.1' currently installed).
  from pandas.core.computation.check import NUMEXPR_INSTALLED
/home/other/johna/.local/lib/python3.10/site-packages/pandas/core/arrays/masked.py:60: UserWarning: Pandas requires version '1.3.6' or newer of 'bottleneck' (version '1.3.2' currently installed).
  from pandas.core import (
/usr/lib/python3/dist-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
/home/other/johna/.local/lib/python3.10/site-packages/matplotlib/projections/__init__.py:63: UserWarning: Unable to import Axes3D. This may be due to multiple versions of Matplotlib being installed (e.g. as a system package and as a pip package). As a result, the 3D projection is not available.
  warnings.warn("Unable to import Axes3D. This may be due to multiple versions of "
====================================================================================================
ENTROPY-BALANCED CROSS-VALIDATION - v2.6.7 FILTERED
====================================================================================================
β schedule: 1e-10 → 0.75 over 50 epochs
Dataset: FILTERED (≥100 samples per class)

Full dataset statistics:
  Total samples: 238,359
  Unique lithologies: 134
  Lithology entropy: 3.115

Computing dominant lithology per borehole...
  Done! Found 296 boreholes
Total boreholes: 296
Unique dominant lithologies: 50
Lithologies with ≥10 boreholes: 6
Boreholes grouped as 'Other': 111

Device: cuda
K-fold CV: 5 folds (stratified by dominant lithology)

====================================================================================================
FOLD 1/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.115, n_lith=134
  Train set:     entropy=3.078, n_lith=122
  Test set:      entropy=2.986, n_lith=93
  Train Δentropy: 0.037
  Test Δentropy:  0.129

Train: 160,819 samples (202 boreholes)
Val:   29,284 samples (34 boreholes)
Test:  48,256 samples (60 boreholes)

Results:
  Training time: 46.8s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=18, ARI=0.2173, Sil=0.2304

====================================================================================================
FOLD 2/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.115, n_lith=134
  Train set:     entropy=3.096, n_lith=129
  Test set:      entropy=2.986, n_lith=82
  Train Δentropy: 0.019
  Test Δentropy:  0.128

Train: 159,653 samples (203 boreholes)
Val:   26,018 samples (34 boreholes)
Test:  52,688 samples (59 boreholes)

Results:
  Training time: 44.3s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=12, ARI=0.1541, Sil=0.1711

====================================================================================================
FOLD 3/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.115, n_lith=134
  Train set:     entropy=3.150, n_lith=128
  Test set:      entropy=2.734, n_lith=77
  Train Δentropy: 0.035
  Test Δentropy:  0.380

Train: 166,536 samples (203 boreholes)
Val:   28,680 samples (34 boreholes)
Test:  43,143 samples (59 boreholes)

Results:
  Training time: 51.8s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=10, ARI=0.2425, Sil=0.1839

====================================================================================================
FOLD 4/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.115, n_lith=134
  Train set:     entropy=3.045, n_lith=128
  Test set:      entropy=3.090, n_lith=75
  Train Δentropy: 0.070
  Test Δentropy:  0.025

Train: 163,269 samples (203 boreholes)
Val:   27,227 samples (34 boreholes)
Test:  47,863 samples (59 boreholes)

Results:
  Training time: 46.0s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=18, ARI=0.2731, Sil=0.2164

====================================================================================================
FOLD 5/5
====================================================================================================
Lithology diversity:
  Full dataset:  entropy=3.115, n_lith=134
  Train set:     entropy=3.129, n_lith=127
  Test set:      entropy=2.847, n_lith=83
  Train Δentropy: 0.015
  Test Δentropy:  0.267

Train: 165,317 samples (203 boreholes)
Val:   26,633 samples (34 boreholes)
Test:  46,409 samples (59 boreholes)

Results:
  Training time: 46.7s
  Collapsed dims: 6/10
  Effective dim: 4
  Best clustering: k=10, ARI=0.1798, Sil=0.1552

====================================================================================================
ENTROPY-BALANCED CROSS-VALIDATION SUMMARY - v2.6.7
====================================================================================================

 fold  train_samples  test_samples  train_entropy  test_entropy  train_entropy_diff  test_entropy_diff  best_k  best_ari  best_sil
    1         160819         48256       3.078013      2.985881            0.036541           0.128673      18  0.217293  0.230424
    2         159653         52688       3.095941      2.986214            0.018612           0.128339      12  0.154117  0.171057
    3         166536         43143       3.149770      2.734380            0.035217           0.380174      10  0.242512  0.183854
    4         163269         47863       3.044870      3.089577            0.069683           0.024976      18  0.273101  0.216362
    5         165317         46409       3.129435      2.847258            0.014882           0.267295      10  0.179785  0.155197

ARI Statistics:
  Mean: 0.2134
  Std:  0.0476
  Min:  0.1541
  Max:  0.2731
  95% CI: [0.1200, 0.3067]

Entropy Balance:
  Full dataset entropy: 3.115
  Mean test entropy diff: 0.186
  Max test entropy diff: 0.380

====================================================================================================
COMPARISON TO ORIGINAL v2.6.7
====================================================================================================
v2.6.7 ORIGINAL (238,506 samples, 14 classes): ARI = 0.196 ± 0.037
v2.6.7 FILTERED (238,359 samples, 12 classes): ARI = 0.2134 ± 0.0476

Change: +8.9%

✓ Filtering tiny classes improves clustering (they were noise)
====================================================================================================

✓ Results saved to: vae_v2_6_7_filtered_cv.csv
